<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Full Article - NewsSphere</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="/static/style.css">
</head>
<body>

<header>
  <h1><a href="/">üóûÔ∏è NewsSphere</a></h1>
  <span>Top Headlines</span>
</header>

<!-- Second Navbar -->
<nav class="second-navbar">
  <span id="menuToggle" class="menu-icon">‚ò∞</span>
  <a href="#" onclick="fetchNews('general', this)">Home</a>
  <a href="#" onclick="fetchNews('india', this)">India</a>
  <a href="#" onclick="fetchNews('world', this)">World</a>
  <a href="#" onclick="fetchNews('sports', this)">Sports</a>
  <a href="#" onclick="fetchNews('technology', this)">Technology</a>
  <a href="#" onclick="fetchNews('entertainment', this)">Entertainment</a>
  <a href="#" onclick="fetchNews('business', this)">Business</a>
  <a href="#" onclick="fetchNews('health', this)">Health</a>

  <form id="search-form" class="nav-search">
    <input type="text" id="search-input" placeholder="Search news...">
    <button type="submit">üîç</button>
  </form>

  <span id="current-date" class="nav-date"></span>
</nav>

<!-- Sidebar -->
<div id="sideMenu" class="side-menu">
  <a href="#" onclick="fetchNews('general', this)">Home</a>
  <a href="#" onclick="fetchNews('india', this)">India</a>
  <a href="#" onclick="fetchNews('world', this)">World</a>
  <a href="#" onclick="fetchNews('sports', this)">Sports</a>
  <a href="#" onclick="fetchNews('technology', this)">Technology</a>
  <a href="#" onclick="fetchNews('entertainment', this)">Entertainment</a>
  <a href="#" onclick="fetchNews('business', this)">Business</a>
  <a href="#" onclick="fetchNews('health', this)">Health</a>
    <!-- Activity Button -->
  {% if session.user %}
      <a href="{{ url_for('activity.my_activity') }}">My Activity</a>
  {% else %}
      <a href="{{ url_for('login', next=url_for('activity.my_activity')) }}">My Activity</a>
  {% endif %}

  <span id="sidebar-user-info"></span>
</div>

<div class="article-container">
  <img id="article-image" class="article-image" src="" alt="Article Image">
  <h1 id="article-title" class="article-title"></h1>
  <p class="article-author" id="article-author"></p>
  <p id="article-content" class="article-content"></p>
  <p><strong>Bias:</strong> {{ bias | capitalize }}</p>

  <div class="button-row">
    <a href="/" class="back-btn">‚Üê Back to News</a>
    <a id="full-link" class="full-link" href="#" target="_blank">Read full article on original site ‚Üí</a>
  </div>
</div>

<!-- üîπ Search Results Container -->
<div id="news-container" class="news-container"></div>

<footer>
  &copy; 2025 NewsSphere | Powered by Aditya Pachkor
</footer>

<!-- Scripts -->
<script>
  // üîπ Truncate helper
  function truncateText(text, length = 200) {
    if (!text) return "";
    return text.length > length ? text.substring(0, length) + "..." : text;
  }

  // Display selected article
  const article = JSON.parse(localStorage.getItem("selectedArticle"));
  if (article) {
    document.getElementById("article-title").innerText = article.title || "No Title";
    document.getElementById("article-image").src = article.urlToImage || "https://via.placeholder.com/800x400";
    document.getElementById("article-author").innerText = article.source?.name || "Unknown Source";
    // üîπ Limit article content
    document.getElementById("article-content").innerText =
      truncateText(article.content || article.description || "No content available.", 400);
    document.getElementById("full-link").href = article.url || "#";
  } else {
    document.querySelector('.article-container').innerHTML = "<p>Article not found.</p>";
  }

  // Fetch news and store selected category
  function fetchNews(category = 'general', btn = null) {
    localStorage.setItem('selectedCategory', category);
    if (btn) {
      document.querySelectorAll('.second-navbar a').forEach(a => a.classList.remove('active'));
      btn.classList.add('active');
    } else {
      document.querySelectorAll('.second-navbar a').forEach(a => {
        if (a.innerText.toLowerCase() === category) a.classList.add('active');
      });
    }
    window.location.href = `/?category=${category}`;
  }

  // On load: set active category and sidebar user info
  window.onload = () => {
    const savedCategory = localStorage.getItem('selectedCategory') || 'general';
    document.querySelectorAll('.second-navbar a').forEach(a => {
      if (a.innerText.toLowerCase() === savedCategory) a.classList.add('active');
    });

    const userInfo = localStorage.getItem('userInfo');
    document.getElementById('sidebar-user-info').innerHTML = userInfo || '<a href="/login">Login</a>';
  };

  document.addEventListener("DOMContentLoaded", () => {
    const dateSpan = document.getElementById("current-date");
    const today = new Date();
    const options = { weekday: "long", year: "numeric", month: "short", day: "numeric" };
    dateSpan.textContent = today.toLocaleDateString("en-US", options);
  });

  // Handle search
  document.getElementById("search-form").addEventListener("submit", function(e) {
    e.preventDefault();
    const query = document.getElementById("search-input").value.trim();
    if (query) {
      fetch(`/search-news?query=${encodeURIComponent(query)}`)
        .then(res => res.json())
        .then(data => {
          const container = document.getElementById("news-container");
          container.innerHTML = "";
          const articles = data.articles || [];

          if (articles.length > 0) {
            articles.forEach(article => {
              if (!article.url || !article.title) return;
              const img = article.urlToImage || 'https://via.placeholder.com/300x180';
              container.innerHTML += `
                <div class="news-card" onclick='onCardClick(${JSON.stringify(article).replace(/'/g, "\\'")})'>
                  <img src="${img}" alt="News">
                  <div class="news-content">
                    <div class="news-title">${article.title}</div>
                    <p class="news-desc">${truncateText(article.description || article.content, 120)}</p>
                    <a class="news-link" href="/article" onclick='event.stopPropagation(); saveArticle(${JSON.stringify(article).replace(/'/g, "\\'")})'>Read more</a>
                  </div>
                </div>
              `;
            });
          } else {
            container.innerHTML = "<p>No results found.</p>";
          }
        })
        .catch(err => {
          console.error("Error searching news:", err);
        });
    }
  });
</script>

<script src="/static/sidebar.js"></script>

</body>
</html>
